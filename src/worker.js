const _0x2c798e=_0x48d6;(function(_0x5a0b85,_0x1866f7){const _0x322e20=_0x48d6,_0x43a487=_0x5a0b85();while(!![]){try{const _0x158ae4=parseInt(_0x322e20(0xf7))/0x1+-parseInt(_0x322e20(0xe8))/0x2*(-parseInt(_0x322e20(0xfe))/0x3)+-parseInt(_0x322e20(0x12c))/0x4*(parseInt(_0x322e20(0x110))/0x5)+-parseInt(_0x322e20(0xee))/0x6*(parseInt(_0x322e20(0x103))/0x7)+parseInt(_0x322e20(0xfa))/0x8+-parseInt(_0x322e20(0xf5))/0x9+-parseInt(_0x322e20(0xec))/0xa;if(_0x158ae4===_0x1866f7)break;else _0x43a487['push'](_0x43a487['shift']());}catch(_0x84381f){_0x43a487['push'](_0x43a487['shift']());}}}(_0x3612,0x5c71b));import{connect}from'cloudflare:sockets';let sha224Password=_0x2c798e(0x12a),proxyIP='';if(!isValidSHA224(sha224Password))throw new Error(_0x2c798e(0xf1));const worker_default={async 'fetch'(_0x68606b,_0x44813d,_0x5e9a5){const _0x4f5ba9=_0x2c798e;try{proxyIP=_0x44813d[_0x4f5ba9(0x109)]||proxyIP,sha224Password=_0x44813d[_0x4f5ba9(0xeb)]||sha224Password;const _0x5c91a0=_0x68606b[_0x4f5ba9(0x122)][_0x4f5ba9(0xef)](_0x4f5ba9(0x11f));if(!_0x5c91a0||_0x5c91a0!==_0x4f5ba9(0x125)){const _0x459988=new URL(_0x68606b[_0x4f5ba9(0x11a)]);switch(_0x459988[_0x4f5ba9(0x12b)]){case'/link':const _0x469c9e=_0x68606b[_0x4f5ba9(0x122)][_0x4f5ba9(0xef)](_0x4f5ba9(0xf9));return new Response('trojan://ca110us@'+_0x469c9e+_0x4f5ba9(0x104)+_0x469c9e+_0x4f5ba9(0x10b),{'status':0xc8,'headers':{'Content-Type':_0x4f5ba9(0x126)}});default:return new Response(_0x4f5ba9(0xff),{'status':0x194});}}else return await trojanOverWSHandler(_0x68606b);}catch(_0x193993){let _0x2c9d33=_0x193993;return new Response(_0x2c9d33[_0x4f5ba9(0x113)]());}}};function _0x48d6(_0xf8ba10,_0x1d6e98){const _0x361267=_0x3612();return _0x48d6=function(_0x48d6d0,_0xf9cb28){_0x48d6d0=_0x48d6d0-0xe6;let _0x134c3d=_0x361267[_0x48d6d0];return _0x134c3d;},_0x48d6(_0xf8ba10,_0x1d6e98);}async function trojanOverWSHandler(_0x5a1b15){const _0x1ecdab=_0x2c798e,_0x3f7803=new WebSocketPair(),[_0x5013a3,_0x442f76]=Object[_0x1ecdab(0x115)](_0x3f7803);_0x442f76['accept']();let _0x7d3505='',_0x1ee77e='';const _0x1bf134=(_0x3d4b96,_0x39bf7a)=>{const _0x29e716=_0x1ecdab;console[_0x29e716(0x114)]('['+_0x7d3505+':'+_0x1ee77e+']\x20'+_0x3d4b96,_0x39bf7a||'');},_0x5b54b7=_0x5a1b15[_0x1ecdab(0x122)][_0x1ecdab(0xef)](_0x1ecdab(0x127))||'',_0x2c7a16=makeReadableWebSocketStream(_0x442f76,_0x5b54b7,_0x1bf134);let _0x418b84={'value':null},_0x55b64d=null;return _0x2c7a16[_0x1ecdab(0x123)](new WritableStream({async 'write'(_0x4d7455,_0x2f0253){const _0xf28ffd=_0x1ecdab;if(_0x55b64d)return _0x55b64d(_0x4d7455);if(_0x418b84[_0xf28ffd(0x11c)]){const _0x2eda05=_0x418b84[_0xf28ffd(0x11c)][_0xf28ffd(0x11b)]['getWriter']();await _0x2eda05['write'](_0x4d7455),_0x2eda05[_0xf28ffd(0x124)]();return;}const {hasError:_0x3c2fb7,message:_0x5193db,portRemote:portRemote=0x1bb,addressRemote:addressRemote='',rawClientData:_0x1da26b}=await parseTrojanHeader(_0x4d7455);_0x7d3505=addressRemote,_0x1ee77e=portRemote+'--'+Math[_0xf28ffd(0xf8)]()+_0xf28ffd(0x12e);if(_0x3c2fb7){throw new Error(_0x5193db);return;}handleTCPOutBound(_0x418b84,addressRemote,portRemote,_0x1da26b,_0x442f76,_0x1bf134);},'close'(){const _0x35945c=_0x1ecdab;_0x1bf134(_0x35945c(0x108));},'abort'(_0x33baa5){const _0x10613e=_0x1ecdab;_0x1bf134(_0x10613e(0xfc),JSON[_0x10613e(0x121)](_0x33baa5));}}))[_0x1ecdab(0xfd)](_0x40784d=>{const _0x114c34=_0x1ecdab;_0x1bf134(_0x114c34(0x101),_0x40784d);}),new Response(null,{'status':0x65,'webSocket':_0x5013a3});}function _0x3612(){const _0x5ea5e7=['addEventListener','710274cVdSuH','get','invalid\x20password','sha224Password\x20is\x20not\x20valid','error','replace','readableStream\x20was\x20canceled,\x20due\x20to\x20','180243PHdBQT','getWriter','595674PlBveS','random','Host','707752emTbTa','message','readableWebSocketStream\x20is\x20aborted','catch','23550lYAlIT','404\x20Not\x20found','remoteSocketToWS\x20error:','readableWebSocketStream\x20pipeTo\x20error','enqueue','21mQmRuy',':443/?type=ws&host=','data','webSocketServer\x20error','close','readableWebSocketStream\x20is\x20closed','PROXYIP','remoteSocket.readable\x20abort','&security=tls','remoteSocket.readable\x20is\x20closed,\x20hasIncomingData:\x20','write','byteLength','invalid\x20addressType\x20is\x20','166675ZwoCTi','stack','from','toString','log','values','retry','push','retry\x20tcpSocket\x20closed\x20error','buffer','url','writable','value','readyState','connected\x20to\x20','Upgrade','join','stringify','headers','pipeTo','releaseLock','websocket','text/plain;charset=utf-8','sec-websocket-protocol','test','safeCloseWebSocket\x20error','08f32643dbdacf81d0d511f1ee24b06de759e90f8edf742bbdc57d88','pathname','24HpPRBd','webSocket\x20connection\x20is\x20not\x20open','\x20tcp','finally','slice','invalid\x20data','readable','118CEErPV','charCodeAt','getUint16','SHA224PASS','1934680HOWidy'];_0x3612=function(){return _0x5ea5e7;};return _0x3612();}async function parseTrojanHeader(_0x18e9be){const _0x214424=_0x2c798e;if(_0x18e9be[_0x214424(0x10e)]<0x38)return{'hasError':!![],'message':_0x214424(0xe6)};let _0x1a9a3c=0x38;if(new Uint8Array(_0x18e9be['slice'](0x38,0x39))[0x0]!==0xd||new Uint8Array(_0x18e9be[_0x214424(0x130)](0x39,0x3a))[0x0]!==0xa)return{'hasError':!![],'message':'invalid\x20header\x20format\x20(missing\x20CR\x20LF)'};const _0x312134=new TextDecoder()['decode'](_0x18e9be[_0x214424(0x130)](0x0,_0x1a9a3c));if(_0x312134!==sha224Password)return{'hasError':!![],'message':_0x214424(0xf0)};const _0x24c512=_0x18e9be[_0x214424(0x130)](_0x1a9a3c+0x2);if(_0x24c512[_0x214424(0x10e)]<0x6)return{'hasError':!![],'message':'invalid\x20SOCKS5\x20request\x20data'};const _0x3ca6b6=new DataView(_0x24c512),_0x6d94d2=_0x3ca6b6['getUint8'](0x0);if(_0x6d94d2!==0x1)return{'hasError':!![],'message':'unsupported\x20command,\x20only\x20TCP\x20(CONNECT)\x20is\x20allowed'};const _0x312dda=_0x3ca6b6['getUint8'](0x1);let _0x1e73a1=0x0,_0x8cfcb7=0x2,_0x3e3044='';switch(_0x312dda){case 0x1:_0x1e73a1=0x4,_0x3e3044=new Uint8Array(_0x24c512[_0x214424(0x130)](_0x8cfcb7,_0x8cfcb7+_0x1e73a1))[_0x214424(0x120)]('.');break;case 0x3:_0x1e73a1=new Uint8Array(_0x24c512[_0x214424(0x130)](_0x8cfcb7,_0x8cfcb7+0x1))[0x0],_0x8cfcb7+=0x1,_0x3e3044=new TextDecoder()['decode'](_0x24c512[_0x214424(0x130)](_0x8cfcb7,_0x8cfcb7+_0x1e73a1));break;case 0x4:_0x1e73a1=0x10;const _0x519c0b=new DataView(_0x24c512[_0x214424(0x130)](_0x8cfcb7,_0x8cfcb7+_0x1e73a1)),_0x5582af=[];for(let _0x4dc580=0x0;_0x4dc580<0x8;_0x4dc580++){_0x5582af[_0x214424(0x117)](_0x519c0b[_0x214424(0xea)](_0x4dc580*0x2)[_0x214424(0x113)](0x10));}_0x3e3044=_0x5582af[_0x214424(0x120)](':');break;default:return{'hasError':!![],'message':_0x214424(0x10f)+_0x312dda};}if(!_0x3e3044)return{'hasError':!![],'message':'address\x20is\x20empty,\x20addressType\x20is\x20'+_0x312dda};const _0x41420d=_0x8cfcb7+_0x1e73a1,_0x5a2148=_0x24c512[_0x214424(0x130)](_0x41420d,_0x41420d+0x2),_0x4e9dff=new DataView(_0x5a2148)[_0x214424(0xea)](0x0);return{'hasError':![],'addressRemote':_0x3e3044,'portRemote':_0x4e9dff,'rawClientData':_0x24c512[_0x214424(0x130)](_0x41420d+0x4)};}async function handleTCPOutBound(_0x39064e,_0xc2db52,_0x100500,_0x4f7309,_0x511d11,_0x47114f){async function _0x168d3b(_0x513c22,_0xbc1065){const _0x5b4ac8=_0x48d6,_0x54636b=connect({'hostname':_0x513c22,'port':_0xbc1065});_0x39064e[_0x5b4ac8(0x11c)]=_0x54636b,_0x47114f(_0x5b4ac8(0x11e)+_0x513c22+':'+_0xbc1065);const _0x2baa7d=_0x54636b[_0x5b4ac8(0x11b)][_0x5b4ac8(0xf6)]();return await _0x2baa7d[_0x5b4ac8(0x10d)](_0x4f7309),_0x2baa7d[_0x5b4ac8(0x124)](),_0x54636b;}async function _0x417741(){const _0xb28bb3=_0x48d6,_0x5adc0d=await _0x168d3b(proxyIP||_0xc2db52,_0x100500);_0x5adc0d['closed'][_0xb28bb3(0xfd)](_0x4134db=>{const _0x22a47d=_0xb28bb3;console[_0x22a47d(0x114)](_0x22a47d(0x118),_0x4134db);})[_0xb28bb3(0x12f)](()=>{safeCloseWebSocket(_0x511d11);}),remoteSocketToWS(_0x5adc0d,_0x511d11,null,_0x47114f);}const _0x16043a=await _0x168d3b(_0xc2db52,_0x100500);remoteSocketToWS(_0x16043a,_0x511d11,_0x417741,_0x47114f);}function makeReadableWebSocketStream(_0x52c2a7,_0x4f350e,_0x17ce5a){let _0x187035=![];const _0x256cf3=new ReadableStream({'start'(_0x131409){const _0x4d77b2=_0x48d6;_0x52c2a7[_0x4d77b2(0xed)](_0x4d77b2(0xfb),_0x5861c9=>{const _0x5b8e3c=_0x4d77b2;if(_0x187035)return;const _0x17bedd=_0x5861c9[_0x5b8e3c(0x105)];_0x131409['enqueue'](_0x17bedd);}),_0x52c2a7[_0x4d77b2(0xed)]('close',()=>{const _0x45ef8e=_0x4d77b2;safeCloseWebSocket(_0x52c2a7);if(_0x187035)return;_0x131409[_0x45ef8e(0x107)]();}),_0x52c2a7[_0x4d77b2(0xed)]('error',_0x5502df=>{const _0x4c496d=_0x4d77b2;_0x17ce5a(_0x4c496d(0x106)),_0x131409[_0x4c496d(0xf2)](_0x5502df);});const {earlyData:_0x38dc9d,error:_0x442a25}=base64ToArrayBuffer(_0x4f350e);if(_0x442a25)_0x131409[_0x4d77b2(0xf2)](_0x442a25);else _0x38dc9d&&_0x131409[_0x4d77b2(0x102)](_0x38dc9d);},'pull'(_0x50b791){},'cancel'(_0x5b3350){const _0xbfa768=_0x48d6;if(_0x187035)return;_0x17ce5a(_0xbfa768(0xf4)+_0x5b3350),_0x187035=!![],safeCloseWebSocket(_0x52c2a7);}});return _0x256cf3;}async function remoteSocketToWS(_0x4ca029,_0x2c5a59,_0x1e6d80,_0x369955){const _0x146423=_0x2c798e;let _0x2ea509=![];await _0x4ca029[_0x146423(0xe7)][_0x146423(0x123)](new WritableStream({'start'(){},async 'write'(_0x22104b,_0x374335){const _0x850e96=_0x146423;_0x2ea509=!![],_0x2c5a59[_0x850e96(0x11d)]!==WS_READY_STATE_OPEN&&_0x374335['error'](_0x850e96(0x12d)),_0x2c5a59['send'](_0x22104b);},'close'(){const _0x3fe60b=_0x146423;_0x369955(_0x3fe60b(0x10c)+_0x2ea509);},'abort'(_0x119bee){const _0x5b6933=_0x146423;console[_0x5b6933(0xf2)](_0x5b6933(0x10a),_0x119bee);}}))[_0x146423(0xfd)](_0x29e082=>{const _0x12dbe0=_0x146423;console[_0x12dbe0(0xf2)](_0x12dbe0(0x100),_0x29e082[_0x12dbe0(0x111)]||_0x29e082),safeCloseWebSocket(_0x2c5a59);}),_0x2ea509===![]&&_0x1e6d80&&(_0x369955(_0x146423(0x116)),_0x1e6d80());}function isValidSHA224(_0x89abfc){const _0x1d4d4a=_0x2c798e,_0x226318=/^[0-9a-f]{56}$/i;return _0x226318[_0x1d4d4a(0x128)](_0x89abfc);}function base64ToArrayBuffer(_0x40381e){const _0x5489e4=_0x2c798e;if(!_0x40381e)return{'error':null};try{_0x40381e=_0x40381e[_0x5489e4(0xf3)](/-/g,'+')[_0x5489e4(0xf3)](/_/g,'/');const _0x50d145=atob(_0x40381e),_0x1d5851=Uint8Array[_0x5489e4(0x112)](_0x50d145,_0x5afbbe=>_0x5afbbe[_0x5489e4(0xe9)](0x0));return{'earlyData':_0x1d5851[_0x5489e4(0x119)],'error':null};}catch(_0x55dcdf){return{'error':_0x55dcdf};}}let WS_READY_STATE_OPEN=0x1,WS_READY_STATE_CLOSING=0x2;function safeCloseWebSocket(_0x2b1602){const _0x3130bd=_0x2c798e;try{(_0x2b1602['readyState']===WS_READY_STATE_OPEN||_0x2b1602[_0x3130bd(0x11d)]===WS_READY_STATE_CLOSING)&&_0x2b1602[_0x3130bd(0x107)]();}catch(_0x3cef27){console[_0x3130bd(0xf2)](_0x3130bd(0x129),_0x3cef27);}}export{worker_default as default};
